/// @file swapchain.ixx
/// @author Xein
/// @date 27-Nov-2025
module;

#include <vulkan/vulkan_raii.hpp>

export module vulkan.swapchain;

namespace vulkan {

export class Swapchain {
public:
	Swapchain();
	static Swapchain* swapchain();
	static Swapchain* operator()();

	[[nodiscard]]
	static vk::raii::SwapchainKHR* get() { return &swapchain()->m_swapchain; }
	[[nodiscard]]
	static vk::Image& image(std::size_t index) { return swapchain()->m_images[index]; }
	[[nodiscard]]
	static vk::raii::ImageView& view(std::size_t index) { return swapchain()->m_imageViews[index]; }
	[[nodiscard]]
	static vk::Format format() { return swapchain()->m_format; }
	[[nodiscard]]
	static vk::Extent2D extent() { return swapchain()->m_extent; }

private:
	static Swapchain* m_instance;
	vk::raii::SwapchainKHR m_swapchain = nullptr;
	std::vector<vk::Image> m_images;
	std::vector<vk::raii::ImageView> m_imageViews;

	vk::SurfaceFormatKHR m_surfaceFormat;
	vk::Format m_format = vk::Format::eUndefined;
	vk::PresentModeKHR m_presentMode;
	vk::Extent2D m_extent;

	vk::SurfaceFormatKHR ChooseSurfaceFormat(const std::vector<vk::SurfaceFormatKHR>& formats);
	vk::PresentModeKHR ChoosePresentMode(const std::vector<vk::PresentModeKHR>& modes);
	vk::Extent2D ChooseExtent(const vk::SurfaceCapabilitiesKHR& capabilities);
	void CreateImageViews();
};

export Swapchain* swapchain() { return Swapchain::swapchain(); }

}
